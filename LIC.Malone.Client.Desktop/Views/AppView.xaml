<metro:MetroWindow
	x:Class="LIC.Malone.Client.Desktop.Views.AppView"
	xmlns:metro="clr-namespace:MahApps.Metro.Controls;assembly=MahApps.Metro"
	xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
	xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
	xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
	xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
	xmlns:cal="http://www.caliburnproject.org"
	xmlns:syntaxControl="clr-namespace:AurelienRibon.Ui.SyntaxHighlightBox;assembly=AurelienRibon.Ui.SyntaxHighlightBox"
	mc:Ignorable="d"
	Title="Malone"
	GlowBrush="{DynamicResource AccentColorBrush}"
	WindowStartupLocation="CenterScreen"
	MinWidth="1000" MinHeight="800"
	Width="1000" Height="800">

	<Grid>
		<Grid.ColumnDefinitions>
			<ColumnDefinition Width="300" MinWidth="300" />
			<ColumnDefinition Width="2" />
			<ColumnDefinition Width="*" MinWidth="500" />
		</Grid.ColumnDefinitions>

		<DockPanel Grid.Column="0" LastChildFill="True">

			<TextBlock DockPanel.Dock="Top" Height="40" Style="{StaticResource H1}" HorizontalAlignment="Left" Text="History" Margin="8,0,0,0"/>

			<ListBox x:Name="History" HorizontalAlignment="Stretch" SelectionMode="Single"
				cal:Message.Attach="[Event PreviewMouseLeftButtonUp] = [Action HistoryClicked($executionContext)]">

				<ListBox.ItemTemplate>
					<DataTemplate>
						<Grid Margin="5,5">
							<Grid.ColumnDefinitions>
								<ColumnDefinition Width="40" />
								<ColumnDefinition Width="*" />
							</Grid.ColumnDefinitions>
							<Grid.RowDefinitions>
								<RowDefinition />
								<RowDefinition />
							</Grid.RowDefinitions>
							<TextBlock Grid.Column="0" Grid.RowSpan="2" Text="{Binding Method}" Style="{StaticResource History.Method}" />
							<TextBlock Grid.Column="1" Grid.Row="0" Text="{Binding BaseUrl}" Style="{StaticResource History.BaseUrl}" />
							<TextBlock Grid.Column="1" Grid.Row="1" Text="{Binding ResourcePath}" Style="{StaticResource History.ResourcePath}" />
						</Grid>
					</DataTemplate>
				</ListBox.ItemTemplate>

			</ListBox>

		</DockPanel>

		<GridSplitter Grid.Column="1" Width="2" HorizontalAlignment="Stretch" />

		<TextBlock Grid.Column="2" Height="40" Style="{StaticResource H1}" VerticalAlignment="Top" HorizontalAlignment="Left" Text="Request" Margin="8,0,0,0"/>

		<Grid Name="CurrentRequestGrid" Grid.Column="2" Margin="8,50,0,0">
			<Grid.ColumnDefinitions>
				<ColumnDefinition Width="100" />
				<ColumnDefinition Width="*" />
			</Grid.ColumnDefinitions>
			<Grid.RowDefinitions>
				<RowDefinition Height="40" />
				<RowDefinition Height="40" />
				<RowDefinition Height="40" />
				<RowDefinition Height="40" />
				<RowDefinition Height="*" />
			</Grid.RowDefinitions>

			<Label Grid.Row="0" Grid.Column="0" VerticalAlignment="Top" Content="Method"/>
			<ComboBox Grid.Row="0" Grid.Column="1" x:Name="Methods" HorizontalAlignment="Left" VerticalAlignment="Top" Width="63" />

			<Label Grid.Row="1" Grid.Column="0" VerticalAlignment="Top" Content="URL"/>
			<TextBox Grid.Row="1" Grid.Column="1" x:Name="Url" metro:TextBoxHelper.Watermark="Enter URL or choose from history"
				FontFamily="Calibri" FontSize="14" Height="26" VerticalAlignment="Top" Margin="0,0,15,0"/>

			<Label Grid.Row="2" Grid.Column="0" VerticalAlignment="Top" Content="Token"/>
			<ComboBox Grid.Row="2" Grid.Column="1" x:Name="Tokens" HorizontalAlignment="Left" VerticalAlignment="Top" Width="200">
				<ComboBox.ItemTemplate>
					<DataTemplate>
						<TextBlock Text="{Binding Name}" />
					</DataTemplate>
				</ComboBox.ItemTemplate>
			</ComboBox>
			<Button Grid.Row="2" Grid.Column="1" x:Name="ManageTokens" Content="Manage Tokens" HorizontalAlignment="Left" VerticalAlignment="Top" Width="110" Margin="230,0,0,0" />

			<Button Grid.Row="3" Grid.Column="1" x:Name="Send" Content="Send" HorizontalAlignment="Left" VerticalAlignment="Top" Width="70"/>

			<Label Grid.Row="4" Grid.Column="0" VerticalAlignment="Top" Content="Response"/>
			<syntaxControl:SyntaxHighlightBox Grid.Row="4" Grid.Column="1" Name="Response" Margin="0,0,15,15" IsReadOnly="True" />
		</Grid>

		<!--<Canvas Grid.Column="2">
			<TextBox x:Name="Token" HorizontalAlignment="Left" Height="73" TextWrapping="Wrap" VerticalAlignment="Top" Width="473" Canvas.Left="493" Canvas.Top="127"/>
		</Canvas>-->
	</Grid>

	<metro:MetroWindow.RightWindowCommands>
		<metro:WindowCommands>
			<Button Content="Manage tokens" cal:Message.Attach="[Event PreviewMouseLeftButtonUp] = [Action ManageTokens()]" />
		</metro:WindowCommands>
	</metro:MetroWindow.RightWindowCommands>

	<!-- TODO: Figure out how to auto-bind inside the flyout. -->
	<metro:MetroWindow.Flyouts>
		<metro:FlyoutsControl Name="AddToken">
			<metro:Flyout Header="Add Token" Position="Right" Width="600" IsOpen="{Binding ShowAddTokenFlyout}">
				<Grid>
					<Label Content="Authentication URL" HorizontalAlignment="Left" Margin="10,10,0,0" VerticalAlignment="Top"/>
					<ComboBox Name="AuthenticationUrls" ItemsSource="{Binding AuthenticationUrls}" SelectedItem="{Binding SelectedAuthenticationUrl}" DisplayMemberPath="AbsoluteUri" SelectedValuePath="Content" HorizontalAlignment="Left"
						Margin="140,10,0,0" VerticalAlignment="Top" Width="400"/>

					<Label Content="Application" HorizontalAlignment="Left" Margin="10,50,0,0" VerticalAlignment="Top"/>
					<ComboBox x:Name="Applications" ItemsSource="{Binding Applications}" SelectedItem="{Binding SelectedApplication}" SelectedValuePath="Content" HorizontalAlignment="Left"
						Margin="140,50,0,0" VerticalAlignment="Top" Width="200">
						<ComboBox.ItemTemplate>
							<DataTemplate>
								<TextBlock Text="{Binding Name}" />
							</DataTemplate>
						</ComboBox.ItemTemplate>
					</ComboBox>

					<Label Content="Username" HorizontalAlignment="Left" Margin="10,90,0,0" VerticalAlignment="Top"/>
					<TextBox x:Name="Username" Text="{Binding Username}"  HorizontalAlignment="Left" Height="23" Margin="140,90,0,0" TextWrapping="Wrap" VerticalAlignment="Top" Width="200"/>

					<Label Content="Password" HorizontalAlignment="Left" Margin="10,130,0,0" VerticalAlignment="Top"/>
					<TextBox x:Name="Password" Text="{Binding Password}" HorizontalAlignment="Left" Height="23" Margin="140,130,0,0" TextWrapping="Wrap" VerticalAlignment="Top" Width="200"/>

					<Button x:Name="Authenticate" Content="Authenticate" cal:Message.Attach="[Event PreviewMouseLeftButtonUp] = [Action Authenticate()]"
						HorizontalAlignment="Left" Margin="140,170,0,0" VerticalAlignment="Top" Width="95" />

					<Label Content="Response" HorizontalAlignment="Left" Margin="10,210,0,0" VerticalAlignment="Top"/>
					<syntaxControl:SyntaxHighlightBox x:Name="AuthResponse" Text="{Binding AuthResponse}"
						Margin="15,240,0,0" Height="300" VerticalAlignment="Top" HorizontalAlignment="Left" Width="570"/>

					<Label Content="Token name" HorizontalAlignment="Left" Margin="10,560,0,0" VerticalAlignment="Top"/>
					<TextBox Name="TokenName" Text="{Binding TokenName}" HorizontalAlignment="Left" Height="23" Margin="145,560,0,0" TextWrapping="Wrap" VerticalAlignment="Top" Width="252"/>

					<Button Name="SaveToken" Content="Save Token" cal:Message.Attach="[Event PreviewMouseLeftButtonUp] = [Action SaveToken()]"
						HorizontalAlignment="Left" Margin="145,600,0,0" VerticalAlignment="Top" Width="87"/>
				</Grid>

			</metro:Flyout>
		</metro:FlyoutsControl>
	</metro:MetroWindow.Flyouts>

</metro:MetroWindow>
